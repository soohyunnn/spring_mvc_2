# ë¡œê·¸ì¸ ì²˜ë¦¬2 - í•„í„°, ì¸í„°ì…‰í„°

## ì„œë¸”ë¦¿ í•„í„° - ì†Œê°œ

### ê³µí†µ ê´€ì‹¬ ì‚¬í•­

ìš”êµ¬ì‚¬í•­ì„ ë³´ë©´ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìë§Œ ìƒí’ˆ ê´€ë¦¬ í˜ì´ì§€ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

ì•ì—ì„œ ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìì—ê²ŒëŠ” ìƒí’ˆ ê´€ë¦¬ ë²„íŠ¼ì´ ë³´ì´ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ì—†ì–´ ë³´ì¸ë‹¤. ê·¸ëŸ°ë° ë¬¸ì œëŠ” ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ë‹¤ìŒ URLì„ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

[`http://localhost:8080/items`](http://localhost:8080/items)

ìƒí’ˆ ê´€ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ë¡œì§ì„ í•˜ë‚˜í•˜ë‚˜ ì‘ì„±í•˜ë©´ ë˜ê² ì§€ë§Œ, ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ìƒí’ˆê´€ë¦¬ì˜ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ì— ê³µí†µìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥´ í™•ì¸í•´ì•¼ í•œë‹¤. ë” í° ë¬¸ì œëŠ” í–¥í›„ ë¡œê·¸ì¸ê³¼ ê´€ë ¨ëœ ë¡œì§ì´ ë³€ê²½ë  ë•Œ ì´ë‹¤. ì‘ì„±í•œ ëª¨ë“  ë¡œì§ì„ ë‹¤ ìˆ˜ì •í•´ì•¼ í•  ìˆ˜ ìˆë‹¤.

ì´ë ‡ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ê´€ì‹¬ì´ ìˆëŠ” ê²ƒì„ ê³µí†µ ê´€ì‹¬ì‚¬(cross-cutting concern)ë¼ê³  í•œë‹¤. ì—¬ê¸°ì„œëŠ” ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ì¸ì¦ì— ëŒ€í•´ì„œ ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆë‹¤.

ì´ëŸ¬í•œ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ìŠ¤í”„ë§ì˜ AOPë¡œë„ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ, ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ì§€ê¸ˆë¶€í„° ì„¤ëª…í•  ì„œë¸”ë¦¿ í•„í„° ë˜ëŠ” ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” HTTPì˜ í—¤ë”ë‚˜ URLì˜ ì •ë³´ë“¤ì´ í•„ìš”í•œë°, ì„œë¸”ë¦¿ í•„í„°ë‚˜ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” HttpServletRequestë¥¼ ì œê³µí•œë‹¤.

### ì„œë¸”ë¦¿ í•„í„° ì†Œê°œ

í•„í„°ëŠ” ì„œë¸”ë¦¿ì´ ì§€ì›í•˜ëŠ” ìˆ˜ë¬¸ì¥ì´ë‹¤. í•„í„°ì˜ íŠ¹ì„±ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

**í•„í„° íë¦„**

```java
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬
```

í•„í„°ë¥¼ ì ìš©í•˜ë©´ í•„í„°ê°€ í˜¸ì¶œ ëœ ë‹¤ìŒì— ì„œë¸”ë¦¿ì´ í˜¸ì¶œëœë‹¤. ê·¸ë˜ì„œ ëª¨ë“  ê³ ê°ì˜ ìš”ì²­ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤ë©´ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì°¸ê³ ë¡œ í•„í„°ëŠ” íŠ¹ì • URL íŒ¨í„´ì— ì ìš©í•  ìˆ˜ ìˆë‹¤. /*ì´ë¼ê³  í•˜ë©´ ëª¨ë“  ìš”ì²­ì— í•„í„°ê°€ ì ìš©ëœë‹¤.

ì°¸ê³ ë¡œ ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì—¬ê¸°ì„œ ë§í•˜ëŠ” ì„œë¸”ë¦¿ì€ ìŠ¤í”„ë§ì˜ ë””ìŠ¤íŒ¨í‹° ì„œë¸”ë¦¿ìœ¼ë¡œ ìƒê°í•˜ë©´ ëœë‹¤.

**í•„í„° ì œí•œ**

```java
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬ //ë¡œê·¸ì¸ ì‚¬ìš©ì
HTTP ìš”ì²­ -> WAS -> í•„í„°(ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ íŒë‹¨, ì„œë¸”ë¦¿ í˜¸ì¶œX) //ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì
```

í•„í„°ì—ì„œ ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•˜ë©´ ê±°ê¸°ì—ì„œ ëì„ ë‚¼ ìˆ˜ë„ ìˆë‹¤. ê·¸ë˜ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸°ì— ë”± ì¢‹ë‹¤.

**í•„í„° ì²´ì¸**

```java
HTTP ìš”ì²­ ->WAS-> í•„í„°1-> í•„í„°2-> í•„í„°3-> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬
```

í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— í•„í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•„í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

**í•„í„° ì¸í„°í˜ì´ìŠ¤**

```java
public interface Filter {

		public default void init(FilterConfig filterConfig) throws ServletException {}
		
		public void doFilter(ServletRequest request, ServletResponse response,
		        FilterChain chain) throws IOException, ServletException;
		
		public default void destroy() {}

}
```

í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ë“±ë¡í•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•„í„°ë¥¼ ì‹±ê¸€í†¤ ê°ì²´ë¡œ ìƒì„±í•˜ê³ , ê´€ë¦¬í•œë‹¤.

- `init()` : í•„í„° ì´ˆê¸°í™” ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í˜¸ì¶œëœë‹¤.
- `doFilter()` : ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. í•„í„°ì˜ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤.
- `destroy()` : í•„í„° ì¢…ë£Œ ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œëœë‹¤.

## ì„œë¸”ë¦¿ í•„í„° - ìš”ì²­ ë¡œê·¸

í•„í„°ê°€ ì •ë§ ìˆ˜ë¬¸ì¥ ì—­í• ì„ ì˜ í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ê°€ì¥ ë‹¨ìˆœí•œ í•„í„°ì¸, ëª¨ë“  ìš”ì²­ì„ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ê°œë°œí•˜ê³  ì ìš©í•´ë³´ì.

**LogFilter - ë¡œê·¸ í•„í„°**

```java
package hello.login.web.filter;

import lombok.extern.slf4j.Slf4j;

import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import java.io.IOException;
import java.util.UUID;

@Slf4j
public class LogFilter implements Filter {
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        log.info("log filter init");
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        log.info("log filter doFilter");

        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String requestURI = httpRequest.getRequestURI();

        String uuid = UUID.randomUUID().toString();
        try {
            log.info("REQUEST [{}][{}]", uuid, requestURI);
            chain.doFilter(request, response);
        } catch (Exception e) {
            throw e;
        } finally {
            log.info("RESPONSE [{}][{}]", uuid, requestURI);
        }
    }

    @Override
    public void destroy() {
        log.info("log filter destroy");
    }
}
```

- `public class LogFilter implements Filter {}`
    - í•„í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- `doFilter(ServletRequest request, ServletResponse response, FilterChain chain)`
    - HTTP ìš”ì²­ì´ ì˜¤ë©´ `doFilter`ê°€ í˜¸ì¶œëœë‹¤.
    - `ServletRequest request`ëŠ” HTTP ìš”ì²­ì´ ï£¿ã…ë‹Œ ê²½ìš°ê¹Œì§€ ê³ ë ¤í•´ì„œ ë§Œë“  ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. HTTPë¥¼ ì‚¬ìš©í•˜ë©´ `HttpServletRequest httpRequest = (HttpServletRequest) request;`ì™€ ê°™ì´ ë‹¤ìš´ ì¼€ìŠ¤íŒ… í•˜ë©´ ëœë‹¤.
- `String uuid = UUID.randomUUID().toString();`
    - HTTP ìš”ì²­ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìš”ì²­ë‹¹ ì„ì˜ì˜ `uuid`ë¥¼ ìƒì„±í•´ë‘”ë‹¤.
- `log.info(â€REQUEST [{}][{}]â€, uuid, requestURI);`
    - `uuid`ì™€ `requestURI`ë¥¼ ì¶œë ¥í•œë‹¤.

- `chain.doFilter(request, response);`
    - ì´ ë¶€ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤. ë‹¤ìŒ í•„í„°ê°€ ìˆìœ¼ë©´ í•„í„°ë¥¼ í˜¸ì¶œí•˜ê³ , í•„í„°ê°€ ì—†ìœ¼ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•œë‹¤. ë§Œì•½ ì´ ë¡œì§ì„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

**WebConfig - í•„í„° ì„¤ì •**

```java
package hello.login;

import hello.login.web.filter.LogFilter;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.servlet.Filter;

@Configuration
public class WebConfig {

    @Bean
    public FilterRegistrationBean logFilter() {
        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
        filterRegistrationBean.setFilter(new LogFilter());
        filterRegistrationBean.setOrder(1);
        filterRegistrationBean.addUrlPatterns("/*");
        return filterRegistrationBean;
    }

}
```

í•„í„°ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ, ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ FilterRegistrationBeanì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•˜ë©´ ëœë‹¤.

- `setFilter(new LogFilter())` : ë“±ë¡í•  í•„í„°ë¥¼ ì§€ì •í•œë‹¤.
- `setOrder(1)` : í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ìˆœì„œê°€ í•„ìš”í•˜ë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € ë™ì‘í•œë‹¤.
- `addUrlPatterns(â€/*â€)` : í•„í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤. í•œë²ˆì— ì—¬ëŸ¬ íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

> ğŸ’¡Â ì°¸ê³ 
URL íŒ¨í„´ì— ëŒ€í•œ ë£°ì€ í•„í„°ë¡œ ì„œë¸”ë¦¿ê³¼ ë™ì¼í•˜ë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì„œë¸”ë¦¿ URL íŒ¨í„´ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ì.
> 

> ğŸ’¡Â ì°¸ê³ 
`@ServletComponentScan` `@WebFilter(filterName = â€œlogFilterâ€, urlPatterns = â€œ/*â€)` ë¡œ í•„í„° ë“±ë¡ì´ ê°€ëŠ¥í•˜ì§€ë§Œ í•„í„° ìˆœì„œ ì¡°ì ˆì´ ì•ˆëœë‹¤. ë”°ë¼ì„œ FilterRegistrationBeanì„ ì‚¬ìš©í•˜ì.
> 

ì‹¤í–‰ ë¡œê·¸

```java
hello.login.web.filter.LogFilter: REQUEST  [0a2249f2-cc70-4db4-98d1-492ccf5629dd][/items]
hello.login.web.filter.LogFilter: RESPONSE [0a2249f2-cc70-4db4-98d1-492ccf5629dd][/items]
```

í•„í„°ë¥¼ ë“±ë¡í•  ë•Œ `urlPattern`ì„ `/*`ë¡œ ë“±ë¡í–ˆê¸° ë•Œë¬¸ì— ëª¨ë“  ìš”ì²­ì— í•´ë‹¹ í•„í„°ê°€ ì ìš©ëœë‹¤.

> ğŸ’¡Â ì°¸ê³ 
ì‹¤ë¬´ì—ì„œ HTTP ìš”ì²­ì‹œ ê°™ì€ ìš”ì²­ì˜ ë¡œê·¸ì— ëª¨ë‘ ê°™ì€ ì‹ë³„ìë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê¸°ëŠ” ë°©ë²•ì€ logback mdcë¡œ ê²€ìƒ‰í•´ë³´ì.
> 

**ì‹¤í–‰ ê²°ê³¼**

```prolog
: log filter doFilter
: REQUEST [355fbce8-b0ed-4f1a-9f9e-e1db1843e976][/]
: RESPONSE [355fbce8-b0ed-4f1a-9f9e-e1db1843e976][/]
: log filter doFilter
: REQUEST [7db7ff9f-6398-4153-9126-1bd9b9e22c07][/css/bootstrap.min.css]
: RESPONSE [7db7ff9f-6398-4153-9126-1bd9b9e22c07][/css/bootstrap.min.css]
: log filter doFilter
: REQUEST [08f07acb-28e7-4a13-8f22-f8e781d280b8][/css/bootstrap.min.css.map]
: RESPONSE [08f07acb-28e7-4a13-8f22-f8e781d280b8][/css/bootstrap.min.css.map]
: log filter doFilter
: REQUEST [5f9b96e3-78c0-422b-8e1b-af1b753386af][/items]
: RESPONSE [5f9b96e3-78c0-422b-8e1b-af1b753386af][/items]
: log filter doFilter
: REQUEST [f3e79a1f-2299-40c3-a360-8efabb700df9][/css/bootstrap.min.css]
: RESPONSE [f3e79a1f-2299-40c3-a360-8efabb700df9][/css/bootstrap.min.css]
: log filter doFilter
: REQUEST [8b7fc9c5-5cee-4e34-b470-c7ce396003f7][/css/bootstrap.min.css.map]
: RESPONSE [8b7fc9c5-5cee-4e34-b470-c7ce396003f7][/css/bootstrap.min.css.map]
: log filter doFilter
: REQUEST [fd1f5178-0e89-4ee1-acd0-29cf968e97f1][/items/add]
: RESPONSE [fd1f5178-0e89-4ee1-acd0-29cf968e97f1][/items/add]
: log filter doFilter
: REQUEST [0e0190f2-fce1-4808-88dc-ed1952c452b5][/css/bootstrap.min.css]
: RESPONSE [0e0190f2-fce1-4808-88dc-ed1952c452b5][/css/bootstrap.min.css]
: log filter doFilter
: REQUEST [ebef714d-9faa-48b4-93d3-7adf025940b4][/css/bootstrap.min.css.map]
: RESPONSE [ebef714d-9faa-48b4-93d3-7adf025940b4][/css/bootstrap.min.css.map]
```

## ì„œë¸”ë¦¿ í•„í„° - ì¸ì¦ ì²´í¬

ë“œë””ì–´ ì¸ì¦ ì²´í¬ í•„í„°ë¥¼ ê°œë°œí•´ë³´ì. ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ìƒí’ˆ ê´€ë¦¬ ë¿ë§Œ ì•„ë‹ˆë¼ ë¯¸ë˜ì— ê°œë°œë  í˜ì´ì§€ì—ë„ ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ì.

**LoginCheckFilter - ì¸ì¦ ì²´í¬ í•„í„°**

```java
package hello.login.web.filter;

import hello.login.web.SessionConst;
import lombok.extern.slf4j.Slf4j;
import org.springframework.util.PatternMatchUtils;

import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

@Slf4j
public class LoginCheckFilter implements Filter {

    private static final String[] whitelist = {"/", "/members/add", "/login", "/css/*"};

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String requestURI = httpRequest.getRequestURI();

        HttpServletResponse httpResponse = (HttpServletResponse) response;

        try {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘{}", requestURI);

            if (isLoginCheckPath(requestURI)) {
                log.info("ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ {}", requestURI);
                HttpSession session = httpRequest.getSession(false);
                if (session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null) {
                    log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­ {}", requestURI);
                    //ë¡œê·¸ì¸ìœ¼ë¡œ redirect
                    httpResponse.sendRedirect("/login?redirectURL=" + requestURI);
                    return; //ì—¬ê¸°ê°€ ì¤‘ìš”!, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ì§€ ì•Šê³  ë!
                }
            }
            chain.doFilter(request, response);
        } catch (Exception e) {
            throw e;  //ì˜ˆì™¸ ë¡œê¹… ê°€ëŠ¥ í•˜ì§€ë§Œ, í†°ìº£ê¹Œì§€ ì˜ˆì™¸ë¥¼ ë³´ë‚´ì¤˜ì•¼ í•¨.
        } finally {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ {}", requestURI);
        }
    }

    /**
     * í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ì˜ ê²½ìš° ì¸ì¦ ì²´í¬ X
     */
    private boolean isLoginCheckPath(String requestURI) {
        return !PatternMatchUtils.simpleMatch(whitelist, requestURI);
    }
}
```

- `whitelist = {â€/â€, â€œ/members/addâ€, â€œ/loginâ€, â€œ/logiytâ€, â€œ/css/*â€};`
    - ì¸ì¦ í•„í„°ë¥¼ ì ìš©í•´ë„ í™ˆ, íšŒì›ê°€ì…, ë¡œê·¸ì¸ í™”ë©´, css ê°™ì€ ë¦¬ì†ŒìŠ¤ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì´ë ‡ê²Œ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ê²½ë¡œëŠ” ì¸ì¦ê³¼ ë¬´ê´€í•˜ê²Œ í•­ìƒ í—ˆìš©í•œë‹¤. í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ëª¨ë“  ê²½ë¡œì—ëŠ” ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.
- `isLoginCheckPath(requestURI)`
    - í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ê²½ìš°ì— ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.
- `httpResponse.sendRedirect(â€/login?redirectURL=â€ + requestURI);`
    - ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤. ê·¸ëŸ°ë° ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ í™ˆìœ¼ë¡œ ì´ë™í•´ë²„ë¦¬ë©´, ì›í•˜ëŠ” ê²½ë¡œë¥¼ ë‹¤ì‹œ ì°¾ì•„ê°€ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì„ ë³´ë ¤ê³  ë“¤ì–´ê°”ë‹¤ê°€ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë©´, ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì´ëŸ° ë¶€ë¶„ì´ ê°œë°œì ì…ì¥ì—ì„œëŠ” ì¢€ ê·€ì°®ì„ ìˆ˜ ìˆì–´ë„ ì‚¬ìš©ì ì…ì¥ìœ¼ë¡œ ë³´ë©´ í¸ë¦¬í•œ ê¸°ëŠ¥ì´ë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ìœ„í•´ í˜„ì¬ ìš”ì²­í•œ ê²½ë¡œì¸ `requestURI`ë¥¼ `/login`ì— ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ í•¨ê»˜ ì „ë‹¬í•œë‹¤. ë¬¼ë¡  `/login` ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì€ ì¶”ê°€ë¡œ ê°œë°œí•´ì•¼ í•œë‹¤.
- `return;` ì—¬ê¸°ê°€ ì¤‘ìš”í•˜ë‹¤. í•„í„°ë¥¼ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´í›„ í•„í„°ëŠ” ë¬¼ë¡  ì„œë¸”ë¦¿, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë”ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. ì•ì„œ `redirect`ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— `redirect`ê°€ ì‘ë‹µìœ¼ë¡œ ì ìš©ë˜ê³  ìš”ì²­ì´ ëë‚œë‹¤.

**WebConfig - loginCheckFilter() ì¶”ê°€**

```java
@Bean
public FilterRegistrationBean loginCheckFilter() {
    FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
    filterRegistrationBean.setFilter(new LoginCheckFilter());
    filterRegistrationBean.setOrder(2);
    filterRegistrationBean.addUrlPatterns("/*");
    return filterRegistrationBean;
}
```

- `setFilter(new LoginfCheckFilter())` : ë¡œê·¸ì¸ í•„í„°ë¥¼ ë“±ë¡í•œë‹¤.
- setOrder(2) : ìˆœì„œë¥¼ 2ë²ˆìœ¼ë¡œ ì¡ì•˜ë‹¤. ë¡œê·¸ í•„í„° ë‹¤ìŒì— ë¡œê·¸ì¸ í•„í„°ê°€ ì ìš©ëœë‹¤.
- addUrlPatterns(â€/*â€) : ëª¨ë“  ìš”ì²­ì— ë¡œê·¸ì¸ í•„í„°ë¥¼ ì ìš©í•œë‹¤.

### **RedirectURL ì²˜ë¦¬**

ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì²˜ìŒ ìš”ì²­í•œ URLë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•´ë³´ì.

**LoginController - loginV4()**

```java
@PostMapping("/login")
public String loginV4(@Valid @ModelAttribute LoginForm form, BindingResult bindingResult,
                      @RequestParam(defaultValue = "/") String redirectURL,
                      HttpServletRequest request) {
    if (bindingResult.hasErrors()) {
        return "login/loginForm";
    }

    Member loginMember = loginService.login(form.getLoginId(), form.getPassword());
    log.info("login? {}", loginMember);

    if (loginMember == null) {
        bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return "login/loginForm";
    }

    //ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬

    //ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìˆëŠ” ì„¸ì…˜ ë°˜í™˜, ì—†ìœ¼ë©´ ì‹ ê·œ ì„¸ì…˜ ìƒì„±
    HttpSession session = request.getSession();
    //ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€
    session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember);

    return "redirect:" + redirectURL;
}
```

- ë¡œê·¸ì¸ ì²´í¬ í•„í„°ì—ì„œ, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ìš”ì²­ ê²½ë¡œë¥¼ í¬í•¨í•´ì„œ `/login`ì— `redirectURL` ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•´ì„œ ìš”ì²­í–ˆë‹¤. ì´ ê°’ì„ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ê³ ê°ì„ `redirect`í•œë‹¤.

[`http://localhost:8080/items`](http://localhost:8080/items) ë¡œ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë¡œê·¸ê°€ ì°íˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```prolog
log filter doFilter
REQUEST [37c3f229-491d-402f-90d5-a0c102e601a2][/login]
ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘/login
login? Member(id=1, loginId=test, name=í…ŒìŠ¤í„°, password=test!)
ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ /login
RESPONSE [37c3f229-491d-402f-90d5-a0c102e601a2][/login]
log filter doFilter
REQUEST [9a3189b1-5880-4c8a-bb79-dc15f2509e9c][/items]
ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘/items
ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ /items
ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ /items
RESPONSE [9a3189b1-5880-4c8a-bb79-dc15f2509e9c][/items]
log filter doFilter
REQUEST [453763b1-c7d4-4e7e-9ece-d877ce86af18][/css/bootstrap.min.css.map]
ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘/css/bootstrap.min.css.map
ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ /css/bootstrap.min.css.map
RESPONSE [453763b1-c7d4-4e7e-9ece-d877ce86af18][/css/bootstrap.min.css.map]
```

**ì •ë¦¬**

ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì˜ ì‚¬ìš©í•œ ë•ë¶„ì— ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë‚˜ë¨¸ì§€ ê²½ë¡œì— ë“¤ì–´ê°ˆ ìˆ˜ ì—†ê²Œ ë˜ì—ˆë‹¤. ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì‚¬ìš©í•´ì„œ í•´ê²°í•œ ë•ë¶„ì— í–¥í›„ ë¡œê·¸ì¸ ê´€ë ¨ ì •ì±…ì´ ë³€ê²½ë˜ì–´ë„ ì´ ë¶€ë¶„ë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤.

> ğŸ’¡Â ì°¸ê³ 
í•„í„°ì—ëŠ” ë‹¤ìŒì— ì„¤ëª…í•œ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì œê³µí•˜ì§€ ì•ŠëŠ”, ì•„ì£¼ ê°•ë ¥í•œ ê¸°ëŠ¥ì´ ìˆëŠ”ë° `chain.doFilter(request, response);`ë¥¼ í˜¸ì¶œí•´ì„œ ë‹¤ìŒ í•„í„° ë˜ëŠ” ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•  ë•Œ `request`, `response`ë¥¼ ë‹¤ë¥¸ ê°ì²´ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤. `ServletRequest`, `ServletResponse`ë¥¼ êµ¬í˜„í•œ ë‹¤ë¥¸ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë„˜ê¸°ë©´ í•´ë‹¹ ê°ì²´ê°€ ë‹¤ìŒ í•„í„° ë˜ëŠ” ì„œë¸”ë¦¿ì—ì„œ ì‚¬ìš©ëœë‹¤. ì˜ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì€ ì•„ë‹ˆë‹ˆ ì°¸ê³ ë§Œ í•´ë‘ì.
> 

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - ì†Œê°œ

ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë„ ì„œë¸”ë¦¿ í•„í„°ì™€ ê°™ì´ ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ íš¨ê³¼ì ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì´ë‹¤. ì„œë¸”ë¦¿ í•„í„°ê°€ ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” ê¸°ìˆ ì´ë¼ë©´, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ê¸°ìˆ ì´ë‹¤. ë‘˜ ë‹¤ ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ ì²˜ë¦¬í•˜ì§€ë§Œ, ì ìš©ë˜ëŠ” ìˆœì„œì™€ ë²”ìœ„, ê·¸ë¦¬ê³  ì‚¬ìš©ë°©ë²•ì´ ë‹¤ë¥´ë‹¤.

**ìŠ¤í”„ë§ ì¸í„°ì„¼í„° íë¦„**

```java
HTTP ìš”ì²­ -> WAS-> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬
```

- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ì´ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œ ëœë‹¤.
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ê¸° ë•Œë¬¸ì— ê²°êµ­ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ ì´í›„ì— ë“±ì¥í•˜ê²Œ ëœë‹¤.
    
    ìŠ¤í”„ë§ MVCì˜ ì‹œì‘ì ì´ ë””ìŠ¤íŒ¨í„° ì„œë¸”ë¦¿ì´ë¼ê³  ìƒê°í•´ë³´ë©´ ì´í•´ê°€ ë  ê²ƒì´ë‹¤.
    
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ì—ë„ URL íŒ¨í„´ì„ ì ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì„œë¸”ë¦¿ URL íŒ¨í„´ê³¼ëŠ” ë‹¤ë¥´ê³ , ë§¤ìš° ì •ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì œí•œ**

```java
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬ //ë¡œê·¸ì¸ ì‚¬ìš©ì
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„°(ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ íŒë‹¨, ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ X) // ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì
```

ì¸í„°ì…‰í„°ì—ì„œ ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•˜ë©´ ê±°ê¸°ì—ì„œ ëì„ ë‚¼ ìˆ˜ë„ ìˆë‹¤. ê·¸ë˜ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸°ì— ë”± ì¢‹ë‹¤.

**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì²´ì¸**

```java
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„°1 -> ì¸í„°ì…‰í„°2 -> ì»¨íŠ¸ë¡¤ëŸ¬
```

ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì²´ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— ì¸í„°ì…‰í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ì¸í„°ì…‰í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ì¸í„°ì…‰í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ì§€ê¸ˆê¹Œì§€ ë‚´ìš©ì„ ë³´ë©´ ì„œë¸”ë¦¿ í•„í„°ì™€ í˜¸ì¶œ ë˜ëŠ” ìˆœì„œë§Œ ë‹¤ë¥´ê³ , ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì€ ë¹„ìŠ·í•´ ë³´ì¸ë‹¤. ì•ìœ¼ë¡œ ì„¤ëª…í•˜ê² ì§€ë§Œ, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ í•„í„°ë³´ë‹¤ í¸ë¦¬í•˜ê³ , ë” ì •êµí•˜ê³  ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.

**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì¸í„°í˜ì´ìŠ¤**

ìŠ¤í”„ë§ì˜ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš”í•˜ë ¤ë©´ `HandlerInterceptor` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤.

```java
package org.springframework.web.servlet;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.lang.Nullable;
import org.springframework.web.method.HandlerMethod;

public interface HandlerInterceptor {

	default boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
			throws Exception {

		return true;
	}

	default void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,
			@Nullable ModelAndView modelAndView) throws Exception {
	}

	default void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler,
			@Nullable Exception ex) throws Exception {
	}

}
```

- ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ë‹¨ìˆœí•˜ê²Œ doFilter() í•˜ë‚˜ë§Œ ì œê³µëœë‹¤. ì¸í„°ì…‰í„°ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „(preHandle), í˜¸ì¶œ í›„(postHandle), ìš”ì²­ ì™„ë£Œ ì´í›„(afterCompletion)ì™€ ê°™ì´ ë‹¨ê³„ì ìœ¼ë¡œ ì˜ ì„¸ë¶„í™” ë˜ì–´ ìˆë‹¤.
- ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ë‹¨ìˆœíˆ request, responseë§Œ ì œê³µí–ˆì§€ë§Œ, ì¸í„°ì…‰í„°ëŠ” ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬(handler)ê°€ í˜¸ì¶œë˜ëŠ”ì§€ í˜¸ì¶œ ì •ë³´ë„ ë°›ì„ ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  ì–´ë–¤ modelAndViewê°€ ë°˜í™˜ë˜ëŠ”ì§€ ì‘ë‹µ ì •ë³´ë„ ë°›ì„ ìˆ˜ ìˆë‹¤.

**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° í˜¸ì¶œ íë¦„**

![Untitled](https://github.com/soohyunnn/websocket_client/assets/58289675/1205f003-fffd-40e6-90f3-13bcd44cb093)

**ì •ìƒ íë¦„**

- `preHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤. (ë” ì •í™•íˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤.)
    - `preHandle`ì˜ ì‘ë‹µê°’ì´ `true`ì´ë©´ ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ê³ , `false`ì´ë©´ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. `false`ì¸ ê²½ìš° ë‚˜ë¨¸ì§€ ì¸í„°ì…‰í„°ëŠ” ë¬¼ë¡ ì´ê³ , í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë„ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë¦¼ì—ì„œ 1ë²ˆì—ì„œ ëì´ ë‚˜ë²„ë¦°ë‹¤.
- `postHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ í›„ì— í˜¸ì¶œëœë‹¤. (ë” ì •í™•íˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° í˜¸ì¶œ í›„ì— í˜¸ì¶œëœë‹¤.)
- `afterCompletion` : ë·°ê°€ ë Œë”ë§ ëœ ì´í›„ì— í˜¸ì¶œëœë‹¤.

**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì˜ˆì™¸ ìƒí™©**

![Untitled 1](https://github.com/soohyunnn/websocket_client/assets/58289675/77576e84-2ffc-4d51-af82-b55905f0e15d)

**ì˜ˆì™¸ê°€ ë°œìƒì‹œ**

- `preHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤.
- `postHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `postHandle`ì€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
- `afterCompletion` : `afterCompletion`ì€ í•­ìƒ í˜¸ì¶œëœë‹¤. ì´ ê²½ìš° ì˜ˆì™¸(`ex`)ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì–´ë–¤ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ì§€ ë¡œê·¸ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.

**afterCompletionì€ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í˜¸ì¶œëœë‹¤.**

- ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `postHandle()`ëŠ” í˜¸ì¶œë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì˜ˆì™¸ì™€ ë¬´ê´€í•˜ê²Œ ê³µí†µ ì²˜ë¦¬ë¥¼ í•˜ë ¤ë©´ `afterCompletion()`ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `afterCompletion()`ì— ì˜ˆì™¸ ì •ë³´(`ex`)ë¥¼ í¬í•¨í•´ì„œ í˜¸ì¶œëœë‹¤.

**ì •ë¦¬**

ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVC êµ¬ì¡°ì— íŠ¹í™”ëœ í•„í„° ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤. ìŠ¤í”„ë§ MVCë¥¼ ì‚¬ìš©í•˜ê³ , íŠ¹ë³„íˆ í•„í„°ë¥¼ ê¼­ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ì•„ë‹ˆë¼ë©´ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” í¸ë¦¬í•˜ë‹¤.

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - ìš”ì²­ ë¡œê·¸

**LogInterceptor - ìš”ì²­ ë¡œê·¸ ì¸í„°ì…‰í„°**

```java
package hello.login.web.interceptor;

import lombok.extern.slf4j.Slf4j;
import org.springframework.web.method.HandlerMethod;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.UUID;

@Slf4j
public class LogInterceptor implements HandlerInterceptor {

    public static final String LOG_ID = "logId";

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String requestURI = request.getRequestURI();
        String uuid = UUID.randomUUID().toString();

        request.setAttribute(LOG_ID, uuid);

        //@RequestMapping: HandlerMethod
        //ì •ì  ë¦¬ì†ŒìŠ¤ : ResourceHttpRequestHandler
        if (handler instanceof HandlerMethod) {
            HandlerMethod hm = (HandlerMethod) handler;  //í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
        }

        log.info("REQUEST [{}][{}][{}]", uuid, requestURI, handler);
        return true;  //false  ì§„í–‰ X
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        log.info("postHandle [{}]", modelAndView);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        String requestURI = request.getRequestURI();
        String logId = (String) request.getAttribute(LOG_ID);
        log.info("RESPONSE [{}][{}]", logId, requestURI);
        if (ex != null) {
            log.error("afterCompletion error!!", ex);
        }
    }
}
```

- `String uuid = UUID.randomUUID().toString()`
    - ìš”ì²­ ë¡œê·¸ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ `uuid`ë¥¼ ìƒì„±í•œë‹¤.
- `request.setAttribute(LOG_ID, uuid)`
    - ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ì§€ì—­ë³€ìˆ˜ë¡œ í•´ê²°ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” í˜¸ì¶œ ì‹œì ì´ ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ ìˆë‹¤. ë”°ë¼ì„œ `preHandle`ì—ì„œ ì§€ì •í•œ ê°’ì„ `postHandle`, `afterCompletion`ì—ì„œ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´ ì–´ë”˜ê°€ì— ë‹´ì•„ë‘ì–´ì•¼ í•œë‹¤. `LogInterceptor`ë„ ì‹±ê¸€í†¤ ì²˜ëŸ¼ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ë©¤ë²„ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„í—˜í•˜ë‹¤. ë”°ë¼ì„œ `request`ì— ë‹´ì•„ë‘ì—ˆë‹¤. ì´ ê°’ì€ `afterCompletion`ì—ì„œ `request.getAttribute(LOG_ID)`ë¡œ ì°¾ì•„ì„œ ì‚¬ìš©í•œë‹¤.
- `return true`
    - `true`ë©´ ì •ìƒ í˜¸ì¶œì´ë‹¤. ë‹¤ìŒ ì¸í„°ì…‰í„°ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œëœë‹¤.
    

```java
if (handler instanceof HandlerMethod) {
		HandlerMethod hm = (HandlerMethod) handler; //í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. 
}
```

**HandlerMethod**

í•¸ë“¤ëŸ¬ ì •ë³´ëŠ” ì–´ë–¤ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ê°€ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤. ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ë©´ ì¼ë°˜ì ìœ¼ë¡œ `@Controller`, `@RequestMapping`ì„ í™œìš©í•œ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ë°, ì´ ê²½ìš° í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ `HandleMethod`ê°€ ë„˜ì–´ì˜¨ë‹¤.

**ResourceHttpRequestHandler**

`@Controller`ê°€ ì•„ë‹ˆë¼ `/resources/static`ì™€ ê°™ì€ ì •ì  ë¦¬ì†ŒìŠ¤ê°€ í˜¸ì¶œ ë˜ëŠ” ê²½ìš° `ResourceHttpRequestHandler`ê°€ í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— íƒ€ì…ì— ë”°ë¼ì„œ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.

**postHandle, afterCompletion**

ì¢…ë£Œ ë¡œê·¸ë¥¼ `postHandle`ì´ ì•„ë‹ˆë¼ `afterCompletion`ì—ì„œ ì‹¤í–‰í•œ ì´ìœ ëŠ”, ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²½ìš° `postHandle`ê°€ í˜¸ì¶œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤. `afterCompletion`ì€ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í˜¸ì¶œ ë˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.

**WevConfig - ì¸í„°ì…‰í„° ë“±ë¡**

```java
package hello.login;

import hello.login.web.filter.LogFilter;
import hello.login.web.filter.LoginCheckFilter;
import hello.login.web.interceptor.LogInterceptor;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import javax.servlet.Filter;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    **public void addInterceptors(InterceptorRegistry registry)** {
        registry.addInterceptor(new LogInterceptor())
                .order(1)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**", "/*.ico", "/error");
    }

//    @Bean
//    public FilterRegistrationBean logFilter() {
//        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
//        filterRegistrationBean.setFilter(new LogFilter());
//        filterRegistrationBean.setOrder(1);
//        filterRegistrationBean.addUrlPatterns("/*");
//        return filterRegistrationBean;
//    }

    @Bean
    public FilterRegistrationBean loginCheckFilter() {
        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
        filterRegistrationBean.setFilter(new LoginCheckFilter());
        filterRegistrationBean.setOrder(2);
        filterRegistrationBean.addUrlPatterns("/*");
        return filterRegistrationBean;
    }

}
```

ì¸í„°ì…‰í„°ì™€ í•„í„°ê°€ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ í•„í„°ë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•œ `logFilter()`ì˜ `@Bean`ì€ ì£¼ì„ì²˜ë¦¬í•˜ì.

`WebMvcConfigurer`ê°€ ì œê³µí•˜ëŠ” `addInterceptors()`ë¥¼ ì‚¬ìš©í•´ì„œ ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

- `registry.addInterceptor(new LogInterceptor())` : ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•œë‹¤.
- `order(1)` : ì¸í„°ì…‰í„°ì˜ í˜¸ì¶œ ìˆœì„œë¥¼ ì§€ì •í•œë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € í˜¸ì¶œëœë‹¤.
- `addPathPatterns(â€/**â€)` : ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤.
- `excludePathPatterns(â€/css/**â€, â€œ/*.icoâ€, â€œ/errorâ€)` : ì¸í„°ì…‰í„°ì—ì„œ ì œì™¸í•  íŒ¨í„´ì„ ì§€ì •í•œë‹¤.

í•„í„°ì™€ ë¹„êµí•´ë³´ë©´ ì¸í„°ì…‰í„°ëŠ” `addPathPatterns`, `excludePathPatterns`ë¡œ ë§¤ìš° ì •ë°€í•˜ê²Œ URL íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

**ì‹¤í–‰ ê²°ê³¼**

```prolog
log filter doFilter
REQUEST [576a75e5-4e60-4f74-b617-8be8406f9aa9][/items]
ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘/items
ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ /items
ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­ /items
ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ /items
RESPONSE [576a75e5-4e60-4f74-b617-8be8406f9aa9][/items]
log filter doFilter
REQUEST [6a408ed5-afe4-4779-a8f0-6862918d0596][/login]
ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘/login
REQUEST [d7dcd0a3-4467-4715-837a-9a91f0f3c960][/login][hello.login.web.login.LoginController#loginForm(LoginForm)]
postHandle [ModelAndView [view="login/loginForm"; model={loginForm=LoginForm(loginId=null, password=null), org.springframework.validation.BindingResult.loginForm=org.springframework.validation.BeanPropertyBindingResult: 0 errors}]]
RESPONSE [d7dcd0a3-4467-4715-837a-9a91f0f3c960][/login]
ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ /login
RESPONSE [6a408ed5-afe4-4779-a8f0-6862918d0596][/login]
```

[`http://localhost:8080/items`](http://localhost:8080/items) ì ‘ì† ì‹œ ìœ„ì™€ ê°™ì€ ë¡œê·¸ê°€ ì°íˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ìŠ¤í”„ë§ì˜ URL ê²½ë¡œ**

ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” URL ê²½ë¡œëŠ” ì„œë¸”ë¦¿ ê¸°ìˆ ì´ ì œê³µí•˜ëŠ” URL ê²½ë¡œì™€ ì™„ì „íˆ ë‹¤ë¥´ë‹¤. ë”ìš± ìì„¸í•˜ê³ , ì„¸ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì„ ì°¸ê³ í•˜ì.

**PathPattern ê³µì‹ ë¬¸ì„œ**

```
? í•œ ë¬¸ì ì¼ì¹˜
* ê²½ë¡œ(/) ì•ˆì—ì„œ 0ê°œ ì´ìƒì˜ ë¬¸ì ì¼ì¹˜
** ê²½ë¡œ ëê¹Œì§€ 0ê°œ ì´ìƒì˜ ê²½ë¡œ(/) ì¼ì¹˜
{spring} ê²½ë¡œ(/)ì™€ ì¼ì¹˜í•˜ê³  springì´ë¼ëŠ” ë³€ìˆ˜ë¡œ ìº¡ì²˜
{spring:[a-z]+} matches the regexp [a-z]+ as a path variable named "spring" {spring:[a-z]+} regexp [a-z]+ ì™€ ì¼ì¹˜í•˜ê³ , "spring" ê²½ë¡œ ë³€ìˆ˜ë¡œ ìº¡ì²˜
{*spring} ê²½ë¡œê°€ ëë‚  ë•Œ ê¹Œì§€ 0ê°œ ì´ìƒì˜ ê²½ë¡œ(/)ì™€ ì¼ì¹˜í•˜ê³  springì´ë¼ëŠ” ë³€ìˆ˜ë¡œ ìº¡ì²˜

/pages/t?st.html â€” matches /pages/test.html, /pages/tXst.html but not /pages/
toast.html
/resources/*.png â€” matches all .png files in the resources directory
/resources/** â€” matches all files underneath the /resources/ path, including /
resources/image.png and /resources/css/spring.css
/resources/{*path} â€” matches all files underneath the /resources/ path and
captures their relative path in a variable named "path"; /resources/image.png
will match with "path" â†’ "/image.png", and /resources/css/spring.css will match
with "path" â†’ "/css/spring.css"
/resources/{filename:\\w+}.dat will match /resources/spring.dat and assign the
value "spring" to the filename variable
```

ë§í¬ : [https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/util/pattern/PathPattern.html](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/util/pattern/PathPattern.html)

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - ì¸ì¦ ì²´í¬

ì„œë¸”ë¦¿ í•„í„°ì—ì„œ ì‚¬ìš©í–ˆë˜ ì¸ì¦ ì²´í¬ ê¸°ëŠ¥ì„ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¡œ ê°œë°œí•´ë³´ì.

**LoginCheckInterceptor**

```java
package hello.login.web.interceptor;

import hello.login.web.SessionConst;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

@Slf4j
public class LoginCheckInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String requestURI = request.getRequestURI();

        log.info("ì¸ì¦ ì²´í¬ ì¸í„°ì…‰í„° ì‹¤í–‰ {}", requestURI);
        HttpSession session = request.getSession(false);

        if (session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null) {
            log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­");
            //ë¡œê·¸ì¸ìœ¼ë¡œ redirect
            response.sendRedirect("/login?redirectURL=" + requestURI);
            return false;
        }
        return true;
    }
}
```

ì„œë¸”ë¦¿ í•„í„°ì™€ ë¹„êµí•´ì„œ ì½”ë“œê°€ ë§¤ìš° ê°„ê²°í•˜ë‹¤. ì¸ì¦ì´ë¼ëŠ” ê²ƒì€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì—ë§Œ í˜¸ì¶œë˜ë©´ ëœë‹¤. ë”°ë¼ì„œ `preHandle`ë§Œ êµ¬í˜„í•˜ë©´ ëœë‹¤.

**WebConfigì— ì„¤ì • ì¶”ê°€**

â†’ ìˆœì„œ ì£¼ì˜, ì„¸ë°€í•œ ì„¤ì • ê°€ëŠ¥

```java
package hello.login;

import hello.login.web.filter.LogFilter;
import hello.login.web.filter.LoginCheckFilter;
import hello.login.web.interceptor.LogInterceptor;
import hello.login.web.interceptor.LoginCheckInterceptor;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import javax.servlet.Filter;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LogInterceptor())
                .order(1)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**", "/*.ico", "/error");

        **registry.addInterceptor(new LoginCheckInterceptor())**
                .order(2)
                .addPathPatterns("/**")
                .excludePathPatterns(
                        "/", "members/add", "/login", "/logout",
                        "/css/**", "/*.ico", "/error"
                );
    }

//    @Bean
//    public FilterRegistrationBean logFilter() {
//        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
//        filterRegistrationBean.setFilter(new LogFilter());
//        filterRegistrationBean.setOrder(1);
//        filterRegistrationBean.addUrlPatterns("/*");
//        return filterRegistrationBean;
//    }

//    @Bean
//    public FilterRegistrationBean loginCheckFilter() {
//        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
//        filterRegistrationBean.setFilter(new LoginCheckFilter());
//        filterRegistrationBean.setOrder(2);
//        filterRegistrationBean.addUrlPatterns("/*");
//        return filterRegistrationBean;
//    }

}
```

ì¸í„°ì…‰í„°ì™€ í•„í„°ê°€ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ í•„í„°ë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•œ `logFulter()`, `loginCheckFilter()`ì˜ `@Bean`ì€ ì£¼ì„ì²˜ë¦¬í•˜ì.

ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ê±°ë‚˜ í•˜ì§€ ì•Šì„ ë¶€ë¶„ì€ `addPathPatterns`ì™€ `excluedPathPatterns`ì— ì‘ì„±í•˜ë©´ ëœë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ê²½ë¡œì— í•´ë‹¹ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ë˜ (`/**`), í™ˆ(`/`), íšŒì›ê°€ì…(`/members/add`), ë¡œê·¸ì¸(`/login`), ë¦¬ì†ŒìŠ¤ ì¡°íšŒ(`/css/**`), ì˜¤ë¥˜(`/error`)ì™€ ê°™ì€ ë¶€ë¶„ì€ ë¡œê·¸ì¸ ì²´í¬ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. ì„œë¸”ë¦¿ í•„í„°ì™€ ë¹„êµí•´ë³´ë©´ ë§¤ìš° í¸ë¦¬í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

**ì‹¤í–‰ ê²°ê³¼**

```java
REQUEST [89638eec-0af3-4315-a7e3-e102938a9634][/items][hello.login.web.item.ItemController#items(Model)]
ì¸ì¦ ì²´í¬ ì¸í„°ì…‰í„° ì‹¤í–‰ /items
ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­
RESPONSE [89638eec-0af3-4315-a7e3-e102938a9634][/items]
REQUEST [968c97c2-0cf7-48da-ac54-293de35cbd55][/login][hello.login.web.login.LoginController#loginForm(LoginForm)]
postHandle [ModelAndView [view="login/loginForm"; model={loginForm=LoginForm(loginId=null, password=null), org.springframework.validation.BindingResult.loginForm=org.springframework.validation.BeanPropertyBindingResult: 0 errors}]]
RESPONSE [968c97c2-0cf7-48da-ac54-293de35cbd55][/login]
```

[`http://localhost:8080/items`](http://localhost:8080/items) ì ‘ì† ì‹œ ìœ„ì™€ ê°™ì€ ë¡œê·¸ê°€ ì°íˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ì •ë¦¬**

ì„œë¸”ë¦¿ í•„í„°ì™€ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ê¸°ìˆ ì´ë‹¤.

ì„œë¸”ë¦¿ í•„í„°ì™€ ë¹„êµí•´ì„œ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ê°€ ê°œë°œì ì…ì¥ì—ì„œ í›¨ì”¬ í¸ë¦¬í•˜ë‹¤ëŠ” ê²ƒì„ ì½”ë“œë¡œ ì´í•´í–ˆì„ ê²ƒì´ë‹¤. íŠ¹ë³„í•œ ë¬¸ì œê°€ ì—†ë‹¤ë©´ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

## ArgumentResolver í™œìš©

MVC1í¸ **6. ìŠ¤í”„ë§ MVC - ê¸°ë³¸ ê¸°ëŠ¥ â†’ ìš”ì²­ ë§¤í•‘ í•¸ë“¤ëŸ¬ ì–´ëí„° êµ¬ì¡°**ì—ì„œ `ArgumentResolver`ë¥¼ í•™ìŠµí–ˆë‹¤.

ì´ë²ˆ ì‹œê°„ì—ëŠ” í•´ë‹¹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ íšŒì›ì„ ì¡°ê¸ˆ í¸ë¦¬í•˜ê²Œ ì°¾ì•„ë³´ì.

**HomeController ì¶”ê°€ - homeLoginV3ArgumentResolver()**

```java
@GetMapping("/")
public String homeLoginV3ArgumentResolver(@Login Member loginMember, Model model) {

    //ì„¸ì…˜ì— íšŒì› ë°ì´í„°ê°€ ì—†ìœ¼ë©´ home
    if (loginMember == null) {
        return "home";
    }

    //ì„¸ì…˜ì´ ìœ ì§€ë˜ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™
    model.addAttribute("member", loginMember);
    return "loginHome";
}
```

- `homeLoginV3Spring()`ì˜ `@GetMapping` ì£¼ì„ ì²˜ë¦¬
- ë‹¤ìŒì— ì„¤ëª…í•˜ëŠ” `@Login` ì–´ë…¸í…Œì´ì…˜ì„ ë§Œë“¤ì–´ì•¼ ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ì‚¬ë¼ì§„ë‹¤.

`@Login` ì–´ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ ì§ì ‘ ë§Œë“  `ArgumentResolver`ê°€ ë™ì‘í•´ì„œ ìë™ìœ¼ë¡œ ì„¸ì…˜ì— ìˆëŠ” ë¡œê·¸ì¸ íšŒì›ì„ ì°¾ì•„ì£¼ê³ , ë§Œì•½ ì„¸ì…˜ì— ì—†ë‹¤ë©´ `null`ì„ ë°˜í™˜í•˜ë„ë¡ ê°œë°œí•´ë³´ì.

**@Login ì• ë…¸í…Œì´ì…˜ ìƒì„±**

```java
package hello.login.web.argumentresolver;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target(ElementType.PARAMETER)
@Retention(RetentionPolicy.RUNTIME)
public @interface Login {
}
```

- `@Target(ElementType.PARAMETER)` : íŒŒë¼ë¯¸í„°ì—ë§Œ ì‚¬ìš©
- `@Retention(RetentionPolicy.RUNTIME)` : ë¦¬í”Œë ‰ì…˜ ë“±ì„ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ëŸ°íƒ€ì„ê¹Œì§€ ì–´ë…¸í…Œì´ì…˜ ì •ë³´ê°€ ë‚¨ì•„ìˆìŒ

MVC1ì—ì„œ í•™ìŠµí•œ `HandlerMethodArgumentResolver`ë¥¼ êµ¬í˜„í•´ë³´ì.

**LoginMemberArgumentResolver ìƒì„±**

```java
package hello.login.web.argumentresolver;

import hello.login.domain.member.Member;
import hello.login.web.SessionConst;
import lombok.extern.slf4j.Slf4j;
import org.springframework.core.MethodParameter;
import org.springframework.web.bind.support.WebDataBinderFactory;
import org.springframework.web.context.request.NativeWebRequest;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.method.support.ModelAndViewContainer;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

@Slf4j
public class LoginMemberArgumentResolver implements HandlerMethodArgumentResolver {

    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        log.info("supportParameter ì‹¤í–‰");

        boolean hasLoginAnnotation = parameter.hasParameterAnnotation(Login.class); //íŒŒë¼ë¯¸í„°ì— Login ì–´ë…¸í…Œì´ì…˜ì´ ìˆëŠ”ì§€ í™•ì¸
        boolean hasMemberType = Member.class.isAssignableFrom(parameter.getParameterType());

        return hasLoginAnnotation && hasMemberType;
    }

    @Override
    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {
        log.info("resolveArgument ì‹¤í–‰");

        HttpServletRequest request = (HttpServletRequest) webRequest.getNativeRequest();
        HttpSession session = request.getSession(false);
        if (session == null) {
            return null;
        }

        return session.getAttribute(SessionConst.LOGIN_MEMBER);
    }
}
```

- `supportsParameter()` : `@Login` ì–´ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ì„œ `Member` íƒ€ì…ì´ë©´ í•´ë‹¹ `ArgumentResolver`ê°€ ì‚¬ìš©ëœë‹¤.
- `resolveArgument()` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œ ë˜ì–´ì„œ í•„ìš”í•œ íŒŒë¼ë¯¸í„° ì •ë³´ë¥¼ ìƒì„±í•´ì¤€ë‹¤. ì—¬ê¸°ì„œëŠ” ì„¸ì…˜ì— ìˆëŠ” ë¡œê·¸ì¸ íšŒì› ì •ë³´ì¸ `member` ê°ì²´ë¥¼ ì°¾ì•„ì„œ ë°˜í™˜í•´ì¤€ë‹¤. ì´í›„ ìŠ¤í”„ë§MVCëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì—¬ê¸°ì—ì„œ ë°˜í™˜ëœ `member` ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ì— ì „ë‹¬í•´ì¤€ë‹¤.

**WebMvcConfigurerì— ì„¤ì • ì¶”ê°€**

```java
package hello.login;

import hello.login.web.argumentresolver.LoginMemberArgumentResolver;
import hello.login.web.filter.LogFilter;
import hello.login.web.filter.LoginCheckFilter;
import hello.login.web.interceptor.LogInterceptor;
import hello.login.web.interceptor.LoginCheckInterceptor;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import javax.servlet.Filter;
import java.util.List;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    **@Override
    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
        resolvers.add(new LoginMemberArgumentResolver());
    }**

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LogInterceptor())
                .order(1)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**", "/*.ico", "/error");

        registry.addInterceptor(new LoginCheckInterceptor())
                .order(2)
                .addPathPatterns("/**")
                .excludePathPatterns(
                        "/", "members/add", "/login", "/logout",
                        "/css/**", "/*.ico", "/error"
                );
    }

//    @Bean
//    public FilterRegistrationBean logFilter() {
//        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
//        filterRegistrationBean.setFilter(new LogFilter());
//        filterRegistrationBean.setOrder(1);
//        filterRegistrationBean.addUrlPatterns("/*");
//        return filterRegistrationBean;
//    }

//    @Bean
//    public FilterRegistrationBean loginCheckFilter() {
//        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
//        filterRegistrationBean.setFilter(new LoginCheckFilter());
//        filterRegistrationBean.setOrder(2);
//        filterRegistrationBean.addUrlPatterns("/*");
//        return filterRegistrationBean;
//    }

}
```

ì•ì„œ ê°œë°œí•œ `LoginMemberArgumentResolver`ë¥¼ ë“±ë¡í•˜ì.

ì‹¤í–‰í•´ë³´ë©´, ê²°ê³¼ëŠ” ë™ì¼í•˜ì§€ë§Œ, ë” í¸ë¦¬í•˜ê²Œ ë¡œê·¸ì¸ íšŒì› ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë”°. ì´ë ‡ê²Œ `ArgumentResolver`ë¥¼ í™œìš©í•˜ë©´ ê³µí†µ ì‘ì—…ì´ í•„ìš”í•  ë•Œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë”ìš± í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.